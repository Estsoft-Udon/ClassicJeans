<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/layout">
<head>
  <link rel="stylesheet" href="/css/checkout/result.css">
</head>
<th:block layout:fragment="content">
  <div class="wrap w_1280 questionnaire_result">
    <!-- 로딩 화면 -->
    <div id="loading-screen" class="loading-screen flex_box checkout">
      <div class="tit">
        <h1>답변을 기반으로<br>AI가 회원님의 건강을 분석 중입니다.</h1>
      </div>
      <div class="txt_box">
        <p class="txt">
          꼼꼼한 작성을 위해 <br>
          최대 1분의 시간이 소요될 수 있습니다.<br>
          양해부탁드립니다 ☺️
        </p>
      </div>
      <p class="txt">로딩 중...</p>
      <div class="spinner"></div>
    </div>

    <div id="content" style="display:none;">
      <!-- 실제 페이지 내용 -->
      <div class="tit">
        <h1>기다려주셔서 감사합니다.<br>AI가 회원님의 건강을 분석했습니다.</h1>
      </div>
      <div class="container cont_wr">
        <h2>분석 결과</h2>
        <table>
          <thead>
          <tr>
            <th>항목</th>
            <th>문진표 데이터</th>
            <th>한국 평균 데이터</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>성별</td>
              <td th:text="${request.user != null ? request.user.gender.displayName : request.family.gender.displayName}">남성</td>
              <td th:text="${request.user != null ? request.user.gender.displayName : request.family.gender.displayName}">남성</td>
            </tr>
            <tr>
              <td>나이</td>
              <td th:text="${request.user != null ? request.user.getAge() : request.family.getAge()}"></td>
              <td th:text="${response.ageGroup}"></td>
            </tr>
            <tr>
              <td>신장</td>
              <td th:text="${request.height} + 'cm'">175cm</td>
              <td th:text="${response.averageHeight} + 'cm'">175cm</td>
            </tr>
            <tr>
              <td>체중</td>
              <td th:text="${request.weight} + 'kg'">70kg</td>
              <td th:text="${response.averageWeight} + 'kg'">75kg</td>
            </tr>
            <tr>
              <td>흡연 여부</td>
              <td th:text="${request.smokingStatus.displayName}">비흡연</td>
              <td th:text="${response.smokingRate} + '% 흡연율'">32.8% 흡연율 (출처42)</td>
            </tr>
            <tr>
              <td>음주 빈도</td>
              <td th:text="${request.alcoholConsumption.displayName}">주 1회</td>
              <td th:text="${response.drinkingRate} + ' % 음주율'">57.4% 음주율 (출처41)</td>
            </tr>
            <tr>
              <td>운동 빈도</td>
              <td th:text="${request.exerciseFrequency.displayName}">주 3회</td>
              <td th:text="${response.exerciseRate} + ' % 규칙적 운동 비율'">47.9% 걷기실천율 (출처52)</td>
            </tr>
          </tbody>
        </table>
        <div class="txt_wr">
          <div class="txt_box">
            <h3>* 문진표 추가 정보</h3>
            <ul>
              <li class="dots" th:text="'현재 앓고 있는 만성질환 여부: ' + ${request.chronicDisease.displayName}"></li>
              <li class="dots" th:text="'최근 6개월 내 병원에 방문 여부: ' + ${request.hospitalVisit.displayName}"></li>
              <li class="dots" th:text="'복용 중인 약물: ' + ${request.currentMedication.displayName}"></li>
              <li class="dots" th:text="'식사: ' + ${request.dietPattern.displayName}"></li>
              <li class="dots" th:text="'최근 2주간 기분: ' + ${request.moodStatus.displayName}"></li>
              <li class="dots" th:text="'평소 수면 패턴: ' + ${request.sleepPattern.displayName}"></li>
              <li class="dots" th:text="'일상에서 자립적으로 활동 여부: ' + ${request.independenceLevel.displayName}"></li>
              <li class="dots" th:text="'사회적 활동 참여 여부: ' + ${request.socialParticipation.displayName}"></li>
              <li class="dots" th:text="'유전적 질환 여부: ' + (${request.hasGeneticDisease} ? '있음' : '없음')"></li>
              <li class="dots" th:text="'체중에 변화 여부: ' + ${request.weightChange.displayName}"></li>
              <li class="dots" th:text="'알레르기 여부: ' + (${request.hasAllergy} ? '있음' : '없음')"></li>
            </ul>
          </div>
          <div class="txt_box">
            <h2>종합 평가</h2>
            <ul>
              <li class="dots" th:each="evaluation : ${response.summaryEvaluation}" th:utext="${evaluation.evaluation}"></li>
            </ul>
          </div>
          <div class="txt_box">
            <h2>개선 사항</h2>
            <ul>
              <li class="dots" th:each="suggestion : ${response.improvementSuggestions}" th:utext="${suggestion.suggestion}"></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="btn_wr">
        <button type="button" class="btn">건강 분석표 다운받기</button>
        <button type="button" class="btn">건강 검진 통계 확인하기</button>
      </div>
    </div>
  </div>
  <script>
    window.onload = function() {
      const loadingScreen = document.getElementById('loading-screen');
      const content = document.getElementById('content');

      loadingScreen.style.display = 'none';
      content.style.display = 'block';
      // 임시로 시간 로딩 페이지 시간 늘리기
      // setTimeout(function() {
      //   loadingScreen.style.display = 'none';
      //   content.style.display = 'block';
      // }, 60000);
    };
  </script>
</th:block>
</html>