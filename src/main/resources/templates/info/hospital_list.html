<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/layout">
<head>
    <link rel="stylesheet" href="/css/info/list.css">
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=43674e9fb7f4d940d2c3a46b585a4361&libraries=services"></script>
</head>
<th:block layout:fragment="content">
    <div class="wrap hospital w_1280">
        <div class="tit">
            <h1>공공의료기관찾기</h1>
            <p>지역별로 검색하여 공공의료기관 정보를 확인해보세요!</p>
        </div>
        <div class="search_cont">
            <form id="hospital_form" th:action="@{/hospital_list}" method="get" class="region_form">
                <div class="province_cont">
                    <label for="province">시/도 입력</label>
                    <input type="text" id="province" name="province" placeholder="예: 서울특별시" autocomplete="off">
                    <div id="province-list" class="autocomplete-list"></div>
                </div>

                <div class="district_cont">
                    <label for="district">시/군/구 입력</label>
                    <input type="text" id="district" name="district" placeholder="예: 종로구" autocomplete="off" disabled>
                    <div id="district-list" class="autocomplete-list"></div>
                </div>

                <button type="submit" class="btn" id="search-btn">지역별 병원 검색하기</button>
            </form>
            <form id="search_form" action="/hospital_list" method="GET">
                <div class="search_box">
                    <label for="facility_search"></label>
                    <input type="text" id="facility_search" name="search" placeholder="병원 이름을 입력하세요"
                           th:value="${search}">
                    <button type="submit" class="btn">검색하기</button>
                </div>
            </form>
        </div>
        <section class="list_section">
            <!-- 병원 목록 테이블 -->
            <table id="hospitalTable">
                <thead>
                <tr>
                    <th>병원 이름</th>
                    <th>전화번호</th>
                    <th>주소</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="hospital : ${hospitals}">
                    <td th:text="${hospital.name}"></td>
                    <td th:text="${hospital.phone}"></td>
                    <td class="show_map">
                        <span th:text="${hospital.address}"></span>
                        <button type="button" class="btn view-map" th:data-address="${hospital.address}">지도보기</button>
                    </td>
                </tr>
                </tbody>
            </table>
            <!-- 지도 모달 -->
            <div id="map-modal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="map"></div>
                </div>
            </div>
        </section>
        <!-- 페이지네이션 -->
        <div class="pagination">
            <!-- 첫 페이지 버튼 -->
            <button th:disabled="${currentPage == 0}"
                    th:onclick="|loadHospitals(0, ${size})|">첫 페이지</button>

            <!-- 이전 페이지 버튼 -->
            <button th:disabled="${currentPage == 0}"
                    th:onclick="|loadHospitals(${currentPage - 1}, ${size})|">이전</button>

            <!-- 페이지 숫자 버튼들 -->
            <span th:each="pageNum : ${#numbers.sequence(currentPage - 2, currentPage + 2)}">
                <button th:if="${pageNum >= 0 && pageNum < totalPages}"
                        th:classappend="${pageNum == currentPage ? 'active' : ''}"
                        th:onclick="|loadHospitals(${pageNum}, ${size})|"
                        th:text="${pageNum + 1}"></button>
            </span>

            <!-- 다음 페이지 버튼 -->
            <button th:disabled="${currentPage == totalPages - 1}"
                    th:onclick="|loadHospitals(${currentPage + 1}, ${size})|">다음</button>

            <!-- 마지막 페이지 버튼 -->
            <button th:disabled="${currentPage == totalPages - 1}"
                    th:onclick="|loadHospitals(${totalPages - 1}, ${size})|">마지막 페이지</button>
        </div>
    </div>

    <script src="/js/hospital.js"></script>
    <script src="/js/kakaomap.js"></script>
</th:block>
</html>